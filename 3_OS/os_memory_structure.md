# 스택 영역과 힙 영역

### 힙 영역과 스택 영역의 차이점을 설명하시오.

- 힙: 사용자에 의해 메모리 공간이 동적으로 할당되고 해제됩니다. 런타임에 크기가 결정됩니다.
- 스택: 함수의 호출과 관계되는 지역변수와 매개변수가 저장되는 영역으로 함수의 호출과 함께 할당됩니다. 컴파일 타임에 크기가 결정됩니다.

## 메모리 구조

### **코드(code) 영역**

- 실행할 프로그램의 코드가 저장되는 영역
- CPU는 코드 영역에 저장된 명령어를 하나씩 가져가서 처리
- 텍스트 영역이라고도 함

### **데이터(data) 영역**

- 전역(Global) 변수와 정적(Static) 변수가 저장
- 프로그램의 시작과 함께 할당되며, 프로그램이 종료되면 소멸

### **힙(heap) 영역**

- 사용자가 직접 관리할 수 있는 ‘그리고 해야만 하는’ 메모리 영역
- 사용자에 의해 메모리 공간이 동적으로 할당되고 해제
- 메모리의 낮은 주소에서 높은 주소의 방향으로 할당
- 참조 타입(Reference Type)의 저장 공간

### **스택(stack) 영역**

- 함수의 호출과 관계되는 지역(Local) 변수와 매개(Parameter) 변수가 저장되는 영역
- 함수의 호출과 함께 할당되며, 함수의 호출이 완료되면 소멸
    - 스택 프레임(stack frame) : 스택 영역에 저장되는 함수의 호출 정보
- 메모리의 높은 주소에서 낮은 주소의 방향으로 할당
- 값 타입(Value Type)의 저장 공간이다. Struct(구조체)나 enumeration(열거형)
- 후입선출(LIFO, Last-In First-Out) 방식
- 푸시(push) 동작으로 데이터를 저장하고, 팝(pop) 동작으로 데이터를 인출

![os_memory_structure.png](img%2Fos_memory_structure.png)

### CODE&DATA 영역과 STACK&HEAP 영역과의 비교

Code&Data 영역은 메모리 사용량에 **변동이 없다**

앱이 종료될 시에 이 영역은 메모리에서 해제

반대로 Stack&Heap 영역은 **가변적**이다.

- **만약 스택이나 힙 영역이 거대해져서 상호 간의 영역을 침범하게 되는 경우?**

  스택 영역이 거대해져서 높은 주소로 올라가다가 힙 영역을 침범하면 스택 오버플로우

  그 반대의 경우의 힙 오버플로우 현상이 발생

  예를 들면 for문을 무한히 돌면 **스택 오버플로우** 발생, ARC(swift에서 자동으로 메모리를 관리해주는 방식)에 의해서 관리되지 못한 강한 순환 참조와 같은 문제들로 **힙 오버플로우 발생**


## **스택과 힙 비교**

### **스택**

- 잠깐 사용하고 삭제하는 데이터 저장(지역변수, 매개변수)
- 해당 객체가 정의된 블록(스코프)을 벗어날 때 소멸
- 함수의 호출하는 위치도 저장
- 힙보다 빠름

### **힙**

- 가비지 컬렉터가 없으면 프로그래머가 직접 관리(할당/해제) 필요
- 스택보다 큰 메모리를 할당받기 위해 사용
- 동적 메모리 할당(JAVA: new / C: 포인터)
- delete를 사용하여 해당 객체 메모리 반환
- 스택보다 느림

### 참고자료